# 使用指南：如何新增觸發條件

## 為什麼要手動選擇觸發條件？

這個設計讓你有更大的靈活性：
- ✅ 可以選擇任何 ZBMini 裝置（不限型號）
- ✅ 可以選擇任何觸發動作（toggle、on、off、single 等）
- ✅ 甚至可以選擇其他品牌的智能開關
- ✅ 可以同時新增多個觸發條件

## 步驟說明

### 1. 匯入並選擇藍圖

進入 **設定** → **自動化與場景** → **藍圖** → 找到 **ZBMini R2 Tri-Step Dimming or Off**

點擊 **建立自動化**

### 2. 新增觸發條件（重要！）

你會看到藍圖的設定介面，**但是觸發條件是空的**。

**操作步驟：**

```
1. 在「觸發條件」區域，點擊 [+ 新增觸發條件]

2. 選擇觸發類型：
   ┌─────────────────────────┐
   │ ○ 裝置                  │ ← 選這個
   │ ○ 實體                  │
   │ ○ 狀態                  │
   │ ○ 事件                  │
   │ ...                     │
   └─────────────────────────┘

3. 選擇裝置：
   ┌─────────────────────────┐
   │ 🔍 搜尋裝置...          │
   │                         │
   │ 📱 ZBMini R2 客廳       │ ← 選擇你的 ZBMini
   │ 📱 ZBMini R2 臥室       │
   │ 📱 其他開關...          │
   └─────────────────────────┘

4. 選擇觸發動作：
   ┌─────────────────────────┐
   │ ○ toggle               │ ← 推薦選這個
   │ ○ on                   │
   │ ○ off                  │
   │ ○ single               │
   └─────────────────────────┘
```

### 3. 填寫其他參數

完成觸發條件設定後，繼續填寫：

- **Target Light**（目標燈光）
  - 選擇要控制的燈光實體
  - 例如：`light.living_room`

- **Timer Entity**（計時器實體）
  - 選擇你在 `configuration.yaml` 中建立的 timer
  - 例如：`timer.zbmini_switch_timer`

- **Brightness Levels**（亮度等級）
  - 輸入三個亮度值，用逗號分隔
  - 預設：`30,60,100`
  - 可自訂：`20,50,80` 或 `40,70,100`

### 4. 儲存自動化

給自動化取個名字，例如：「客廳 ZBMini 三段調光」

點擊 **儲存**

## 範例設定

### ZHA 使用者

**觸發條件：**
- 類型：裝置
- 裝置：ZBMini R2 客廳
- 觸發：toggle

**參數：**
- Target Light: `light.living_room_ceiling`
- Timer Entity: `timer.zbmini_living_room`
- Brightness Levels: `30,60,100`

### Zigbee2MQTT 使用者

**觸發條件：**
- 類型：裝置
- 裝置：ZBMini R2 客廳 (MQTT)
- 觸發：toggle

**參數：**
- Target Light: `light.living_room_ceiling`
- Timer Entity: `timer.zbmini_living_room`
- Brightness Levels: `30,60,100`

## 進階用法

### 多個觸發條件

你可以新增多個觸發條件，讓多個開關控制同一盞燈：

```
觸發條件 1：ZBMini R2 客廳 → toggle
觸發條件 2：ZBMini R2 玄關 → toggle
觸發條件 3：其他品牌開關 → toggle
```

這樣三個開關都可以控制同一盞燈！

### 使用不同的觸發動作

```
觸發條件 1：ZBMini R2 → on
觸發條件 2：ZBMini R2 → off
觸發條件 3：ZBMini R2 → toggle
```

這樣可以捕捉所有類型的開關動作。

## 常見問題

### Q: 為什麼不直接在 Blueprint 中選擇裝置？

A: 手動選擇觸發條件提供更大的靈活性：
- 可以選擇任何裝置（不限 ZBMini R2）
- 可以新增多個觸發條件
- 可以自由選擇觸發動作類型

### Q: 我可以用其他品牌的開關嗎？

A: 可以！只要該開關支援裝置觸發（device trigger），都可以使用這個藍圖。

### Q: 觸發條件區域是空的，這正常嗎？

A: 是的！這是設計的一部分。你需要手動新增觸發條件，這樣可以提供最大的彈性。

### Q: 我應該選擇哪個觸發動作？

A: 推薦選擇 **toggle**，這樣可以捕捉所有的開關切換動作。

## 疑難排除

### 找不到「新增觸發條件」按鈕

確認你在正確的位置：
1. 設定 → 自動化與場景 → 藍圖
2. 找到 ZBMini R2 藍圖
3. 點擊「建立自動化」（不是「預覽」）

### 自動化無法觸發

檢查清單：
- ✅ 觸發條件已正確設定
- ✅ 選擇的是正確的裝置
- ✅ Timer entity 已在 `configuration.yaml` 中建立
- ✅ 目標燈光存在且可控制

## 總結

這個設計雖然需要多一步手動選擇觸發條件，但換來了：
- 🎯 更大的靈活性
- 🔧 更容易自訂
- 🚀 支援更多裝置類型
- ✨ 可以新增多個觸發來源

享受你的智能家居體驗！🏠✨
